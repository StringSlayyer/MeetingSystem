@page "/"
@using MeetingSystem.Client.Abstractions
@using MeetingSystem.Contracts.Dashboard
@using Microsoft.AspNetCore.Authorization

@inject IDashboardService DashboardService
@inject IJSRuntime jSRuntime
@inject NavigationManager Nav

@attribute [Authorize]

@if (!isLoaded)
{
    <RadzenText TextStyle="TextStyle.H3">Loading</RadzenText>
}else{

<RadzenStack class="w-80 m-auto">
<RadzenText TextStyle="TextStyle.H4">Hello test</RadzenText>
<RadzenText TextStyle="TextStyle.Body1">Welcome back to your reservation hub.</RadzenText>
</RadzenStack>
<RadzenRow class="w-100" JustifyContent="JustifyContent.SpaceBetween" RowGap="1rem">

        <RadzenCard class="rz-w-auto rz-py-6 rz-my-4" Variant="Variant.Outlined" Style="width: 30% !important; border-radius: 15px; background-color: #FEFCE8;" onclick="@RedirectToCompanies">
    <RadzenStack class="rz-ml-4">
            <RadzenCard Variant="Variant.Flat" class="rz-w-min-content" Style="border-radius: 15px; background-color: #FEF9C3">
                <RadzenIcon Icon="apartment" IconStyle="IconStyle.Dark" />
            </RadzenCard>
        <RadzenText TextStyle="TextStyle.H6">Browse Companies</RadzenText>
        <RadzenText TextStyle="TextStyle.Body1">Explore resources and make bookings</RadzenText>
    </RadzenStack>
</RadzenCard>

<RadzenCard class="rz-w-auto rz-py-6 rz-my-4" Variant="Variant.Outlined" Style="width: 30% !important; border-radius: 15px; background-color: #EFF6FF;">
    <RadzenStack class="rz-ml-4">
            <RadzenCard Variant="Variant.Flat" class="rz-w-min-content" Style="border-radius: 15px; background-color: #DBEAFE;">
                <RadzenIcon Icon="calendar_today" IconStyle="IconStyle.Dark" />
            </RadzenCard>
        <RadzenText TextStyle="TextStyle.H6">@data.ReservationCount Upcoming</RadzenText>
        <RadzenText TextStyle="TextStyle.Body1">You have @data.ReservationCount active reservations.</RadzenText>
    </RadzenStack>
</RadzenCard>

<RadzenCard class="rz-w-auto rz-py-6 rz-my-4" Variant="Variant.Outlined" Style="width: 30% !important; border-radius: 15px; background-color: #FAF5FF;">
    <RadzenStack class="rz-ml-4">
            <RadzenCard Variant="Variant.Flat" class="rz-w-min-content" Style="border-radius: 15px; background-color: #F3E8FF;">
                <RadzenIcon Icon="star" IconStyle="IconStyle.Dark" />
            </RadzenCard>
        <RadzenText TextStyle="TextStyle.H6">Favorites</RadzenText>
        <RadzenText TextStyle="TextStyle.Body1">Quick access to your top spots.</RadzenText>
    </RadzenStack>
</RadzenCard>

</RadzenRow>

<RadzenStack>
    <RadzenText TextStyle="TextStyle.H6">Your upcoming reservations</RadzenText>
    <RadzenStack>
        @foreach (var res in data.Reservations)
        {
        <RadzenCard>
            <RadzenRow JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                <RadzenCard Variant="Variant.Flat" class="rz-w-min-content" Style="border-radius: 15px; background-color: #DBEAFE;">
                    <RadzenIcon Icon="calendar_today" IconStyle="IconStyle.Dark" />
                </RadzenCard>
                <RadzenStack>
                    <RadzenText Text="@res.ResourceName" TextStyle="TextStyle.Subtitle1" />
                    <RadzenText Text="@res.ResourceName" TextStyle="TextStyle.Subtitle2"/>
                </RadzenStack>

                <RadzenStack>
                    <RadzenText Text="@res.Start.Date.ToString()" TextStyle="TextStyle.Subtitle1" />
                    <RadzenText TextStyle="TextStyle.Subtitle2" >@res.Start.Hour : @res.Start.Minute - @res.End.Hour : @res.End.Minute</RadzenText>
                </RadzenStack>

                <RadzenStack>
                <RadzenBadge BadgeStyle="BadgeStyle.Success" Text="Confirmed"/>
                </RadzenStack>
            </RadzenRow>
        </RadzenCard>
        }
    </RadzenStack>
</RadzenStack>

}
<style>
    .rz-card {
        line-height: 0;
    }
</style>

@code {
    private UserDashboardDTO? data;
    bool isLoaded = false;
    protected override async Task OnInitializedAsync()
    {
        var response = await DashboardService.GetUserDashboardAsync();

        await jSRuntime.InvokeVoidAsync("console.log", "Dashboard response: ", response);

        if (response.IsSuccess)
        {
            data = response.Data;
            isLoaded = true;
        }
    }

    public void RedirectToCompanies()
    {
        Nav.NavigateTo("/companies");
    }
}
