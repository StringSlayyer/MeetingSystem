@page "/"
@using MeetingSystem.Client.Abstractions
@using MeetingSystem.Contracts.Dashboard
@using Microsoft.AspNetCore.Authorization

@inject IDashboardService DashboardService
@inject IJSRuntime jSRuntime
@inject NavigationManager Nav

@attribute [Authorize]

@if (!isLoaded)
{
    <RadzenText TextStyle="TextStyle.H3">Loading</RadzenText>
}else{

    <RadzenRow JustifyContent="JustifyContent.SpaceBetween" class="w-80 m-auto">
<RadzenStack >
<RadzenText TextStyle="TextStyle.H4">Hello @data.Name</RadzenText>
<RadzenText TextStyle="TextStyle.Body1">Welcome back to your reservation hub.</RadzenText>
</RadzenStack>
<RadzenStack>
    <RadzenButton Text="Create Company" Icon="add" Click="@RedirectToCreateCompany" />
</RadzenStack>
    </RadzenRow>
<RadzenRow class="w-100" JustifyContent="JustifyContent.SpaceBetween" RowGap="1rem">

        <RadzenCard class="rz-w-auto rz-py-6 rz-my-4" Variant="Variant.Outlined" Style="width: 48% !important; border-radius: 15px; background-color: #FEFCE8;" onclick="@RedirectToCompanies">
            <RadzenStack class="rz-ml-4">
                    <RadzenCard Variant="Variant.Flat" class="rz-w-min-content" Style="border-radius: 15px; background-color: #FEF9C3">
                        <RadzenIcon Icon="apartment" IconStyle="IconStyle.Dark" />
                    </RadzenCard>
                <RadzenText TextStyle="TextStyle.H6">Browse Companies</RadzenText>
                <RadzenText TextStyle="TextStyle.Body1">Explore resources and make bookings</RadzenText>
            </RadzenStack>
        </RadzenCard>

        <RadzenCard class="rz-w-auto rz-py-6 rz-my-4"
                    Variant="Variant.Outlined"
                    Style="width: 48% !important; border-radius: 15px; background-color: #EFF6FF; cursor: pointer;"
                    @onclick="@(() => Nav.NavigateTo("/reservations"))">
            <RadzenStack class="rz-ml-4">
                <RadzenCard Variant="Variant.Flat" class="rz-w-min-content" Style="border-radius: 15px; background-color: #DBEAFE;">
                    <RadzenIcon Icon="calendar_today" IconStyle="IconStyle.Dark" />
                </RadzenCard>
                <RadzenText TextStyle="TextStyle.H6">@data.ReservationCount Upcoming</RadzenText>
                <RadzenText TextStyle="TextStyle.Body1">You have @data.ReservationCount active reservations.</RadzenText>
            </RadzenStack>
        </RadzenCard>



</RadzenRow>

<RadzenStack>
    <RadzenText TextStyle="TextStyle.H6">Your upcoming reservations</RadzenText>
    <RadzenStack>
        @foreach (var res in data.Reservations)
        {
        <RadzenCard @onclick="@(() => Nav.NavigateTo($"/resources/{res.ResourceId}"))">
            <RadzenRow JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                <RadzenCard Variant="Variant.Flat" class="rz-w-min-content" Style="border-radius: 15px; background-color: #DBEAFE;">
                    <RadzenIcon Icon="calendar_today" IconStyle="IconStyle.Dark" />
                </RadzenCard>
                <RadzenStack>
                    <RadzenText Text="@res.ResourceName" TextStyle="TextStyle.Subtitle1"/>
                </RadzenStack>

                <RadzenStack>
                    <RadzenText Text="@res.Start.ToLocalTime().ToString("dd. MMMM yyyy")" TextStyle="TextStyle.Subtitle1" />
                    <RadzenText TextStyle="TextStyle.Subtitle2" >@res.Start.ToLocalTime().ToShortTimeString() - @res.End.ToLocalTime().ToShortTimeString()</RadzenText>
                </RadzenStack>

                <RadzenStack>
                <RadzenBadge BadgeStyle="BadgeStyle.Success" Text="Confirmed"/>
                </RadzenStack>
            </RadzenRow>
        </RadzenCard>
        }
    </RadzenStack>
</RadzenStack>

}
<style>
    .rz-card {
        line-height: 0;
    }
</style>

@code {
    private UserDashboardDTO? data;
    bool isLoaded = false;
    protected override async Task OnInitializedAsync()
    {
        var response = await DashboardService.GetUserDashboardAsync();

        await jSRuntime.InvokeVoidAsync("console.log", "Dashboard response: ", response);

        if (response.IsSuccess)
        {
            data = response.Data;
            Console.WriteLine(data);
            isLoaded = true;
        }
    }

    public void RedirectToCompanies()
    {
        Nav.NavigateTo("/companies");
    }

    public void RedirectToCreateCompany()
    {
        Nav.NavigateTo("/companies/create");
    }
}
